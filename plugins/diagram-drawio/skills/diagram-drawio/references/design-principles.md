# 図の設計原則

## 目次

- [階層化ガイド（C4モデル準拠）](#階層化ガイドc4モデル準拠)
  - [レベル1: Context図](#レベル1-context図)
  - [レベル2: Container図（System図）](#レベル2-container図system図)
  - [レベル3: Component図](#レベル3-component図)
  - [レベル4: Code図（必要時のみ）](#レベル4-code図必要時のみ)
- [図の種類と選択基準](#図の種類と選択基準)
  - [構造を示す図](#構造を示す図)
  - [振る舞いを示す図](#振る舞いを示す図)
- [アクセシビリティガイドライン](#アクセシビリティガイドライン)
  - [色の使用](#色の使用)
  - [コントラスト確認](#コントラスト確認)
  - [フォントサイズ](#フォントサイズ)
- [レイアウトパターン](#レイアウトパターン)
  - [上から下（Top-Down）](#上から下top-down)
  - [左から右（Left-to-Right）](#左から右left-to-right)
  - [レイヤー構造](#レイヤー構造)
  - [ハブ＆スポーク](#ハブスポーク)
- [間隔とサイズの基準](#間隔とサイズの基準)
  - [ノード間隔](#ノード間隔)
  - [ノードサイズ](#ノードサイズ)
  - [日本語テキスト](#日本語テキスト)
- [凡例テンプレート](#凡例テンプレート)
- [チェックリスト](#チェックリスト)
  - [作成前](#作成前)
  - [作成中](#作成中)
  - [作成後](#作成後)

## 階層化ガイド（C4モデル準拠）

### レベル1: Context図

目的: システムの境界と外部との関係を示す。

構成: 外部アクター（上部）→ 対象システム（中央、ブラックボックスとして表現）→ 外部システム/DB（下部）の3層構造で、上から下へデータが流れる。

以下の要素を含める。

- 対象システム（1つのボックス）
- 外部ユーザー/アクター
- 外部システム連携
- データフローの方向

以下の要素は含めない。

- 内部コンポーネント
- 技術的詳細
- インフラ構成

### レベル2: Container図（System図）

目的: システム内の主要コンポーネントを示す。

以下の要素を含める。

- アプリケーション（Web, API, バッチなど）
- データストア（DB, キャッシュ, ファイル）
- メッセージキュー
- 外部サービス連携

抽象度: 技術選択は記載するが、詳細実装は省略する。

### レベル3: Component図

目的: 1つのコンテナ内の構成要素を示す。

以下の要素を含める。

- モジュール/パッケージ
- クラス/サービス
- インターフェース
- 依存関係

### レベル4: Code図（必要時のみ）

目的: 実装レベルの詳細を示す。

以下の種類がある。

- クラス図
- シーケンス図
- ステートマシン図

***

## 図の種類と選択基準

### 構造を示す図

| 図の種類     | 用途       | 最適なケース          |
| -------- | -------- | --------------- |
| アーキテクチャ図 | 技術構成の全体像 | 新規システム設計、技術選定   |
| ER図      | データ構造と関係 | DB設計、データモデリング   |
| クラス図     | オブジェクト構造 | 詳細設計、コードレビュー    |
| ネットワーク図  | インフラ構成   | インフラ設計、セキュリティ監査 |

### 振る舞いを示す図

| 図の種類     | 用途       | 最適なケース         |
| -------- | -------- | -------------- |
| フローチャート  | 処理/業務フロー | 業務分析、アルゴリズム説明  |
| シーケンス図   | 時系列の相互作用 | API設計、トラブルシュート |
| アクティビティ図 | 並行処理フロー  | ワークフロー設計       |
| ステートマシン図 | 状態遷移     | 状態管理の設計        |

***

## アクセシビリティガイドライン

### 色の使用

原則: 色だけに依存しない。

良い例: 処理Aと処理Bをそれぞれ青と緑で色分けし、さらにノード内にラベル「処理A」「処理B」を記載。接続線にも「実線」などの説明を付与。

悪い例: ノード内にラベルがなく、色（青・緑）だけで処理を区別している。色覚特性のあるユーザーには判別できない。

以下を推奨する。

- 色 + ラベルで情報を伝える
- 色 + パターン（実線/破線）を組み合わせる
- コントラスト比4.5:1以上を確保

### コントラスト確認

| 背景色         | 推奨テキスト色 |
| ----------- | ------- |
| #dae8fc (青) | #000000 |
| #d5e8d4 (緑) | #000000 |
| #fff2cc (黄) | #000000 |
| #f8cecc (赤) | #000000 |

### フォントサイズ

| 要素     | 最小サイズ | 推奨サイズ |
| ------ | ----- | ----- |
| ノードラベル | 14px  | 18px  |
| 矢印ラベル  | 12px  | 14px  |
| 凡例     | 12px  | 14px  |
| タイトル   | 18px  | 24px  |

***

## レイアウトパターン

### 上から下（Top-Down）

用途: フローチャート、処理フローに使用する。

構成:「開始」→「処理1」→「終了」の順に、上から下へ垂直に配置し、矢印で接続する。

### 左から右（Left-to-Right）

用途: シーケンス図、タイムラインに使用する。

構成: ノードA → ノードB → ノードCの順に、左から右へ水平に配置し、矢印で接続する。

### レイヤー構造

用途: アーキテクチャ図に使用する。

構成: 上から順に以下の4層を、同一幅の横長矩形として縦に積み重ねる。

1. Presentation Layer
2. Application Layer
3. Domain Layer
4. Infrastructure Layer

各層は境界線で区切る。

### ハブ＆スポーク

用途: 中心的なコンポーネントがある構成に使用する。

構成: 中央に「中心」ノードを配置し、その上下左右にノードA・B・C・Dを配置する。中心から各ノードへ放射状に矢印を伸ばす。

***

## 間隔とサイズの基準

### ノード間隔

| 関係      | 推奨間隔     |
| ------- | -------- |
| 直接接続    | 50-80px  |
| 同グループ内  | 30-50px  |
| 異なるグループ | 80-120px |

### ノードサイズ

| 要素     | 幅      | 高さ   |
| ------ | ------ | ---- |
| 標準ノード  | 120px  | 60px |
| 小ノード   | 80px   | 40px |
| DBシンボル | 80px   | 80px |
| スイムレーン | 200px+ | 可変   |

### 日本語テキスト

| 文字数    | 推奨幅    |
| ------ | ------ |
| 2-4文字  | 80px   |
| 5-8文字  | 120px  |
| 9-12文字 | 160px  |
| 13文字以上 | 200px+ |

***

## 凡例テンプレート

図には必ず凡例を含める。

```xml
<!-- 凡例グループ -->
<mxCell value="凡例" style="swimlane;fontSize=14;fontFamily=Hiragino Sans;" vertex="1" parent="1">
  <mxGeometry x="600" y="400" width="180" height="120" as="geometry"/>
</mxCell>

<!-- 凡例項目 -->
<mxCell value="同期通信" style="rounded=0;html=1;fontSize=12;fontFamily=Hiragino Sans;" vertex="1">
  <mxGeometry x="10" y="30" width="80" height="20" as="geometry"/>
</mxCell>
<mxCell style="endArrow=block;html=1;dashed=0;" edge="1">
  <mxGeometry relative="1" as="geometry">
    <mxPoint x="100" y="40" as="sourcePoint"/>
    <mxPoint x="160" y="40" as="targetPoint"/>
  </mxGeometry>
</mxCell>

<mxCell value="非同期通信" style="rounded=0;html=1;fontSize=12;fontFamily=Hiragino Sans;" vertex="1">
  <mxGeometry x="10" y="60" width="80" height="20" as="geometry"/>
</mxCell>
<mxCell style="endArrow=block;html=1;dashed=1;" edge="1">
  <mxGeometry relative="1" as="geometry">
    <mxPoint x="100" y="70" as="sourcePoint"/>
    <mxPoint x="160" y="70" as="targetPoint"/>
  </mxGeometry>
</mxCell>
```

***

## チェックリスト

### 作成前

- [ ] 目的と対象者を明確にした
- [ ] 目的に合った図の種類を選択した
- [ ] 必要な情報を収集した
- [ ] 抽象度を決定した

### 作成中

- [ ] 1図1目的を守っている
- [ ] 色+ラベルで情報を伝えている
- [ ] フォント設定が全要素にある
- [ ] 矢印が背面に配置されている

### 作成後

- [ ] 凡例を含めた
- [ ] メタデータを記載した
- [ ] PNG出力で確認した
- [ ] 第三者が理解できる
